<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Глава 1 Создаём бота, и отправляем с его помощью сообщения в telegram (1) | Разработка telegram ботов на языке R</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Глава 1 Создаём бота, и отправляем с его помощью сообщения в telegram (1) | Разработка telegram ботов на языке R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Глава 1 Создаём бота, и отправляем с его помощью сообщения в telegram (1) | Разработка telegram ботов на языке R" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Алексей Селезнёв" />


<meta name="date" content="2021-06-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="-updater-2.html"/>
<script src="libs/header-attrs-2.8/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-114798296-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-114798296-1');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Разработка Telegram ботов на языке R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Введение</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#предисловие"><i class="fa fa-check"></i>Предисловие</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#навыки-необходимые-для-прохождения-учебника"><i class="fa fa-check"></i>Навыки необходимые для прохождения учебника</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#об-авторе"><i class="fa fa-check"></i>Об авторе</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#правки-и-предложения"><i class="fa fa-check"></i>Правки и предложения</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#поддержать-проект"><i class="fa fa-check"></i>Поддержать проект</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="-telegram-1.html"><a href="-telegram-1.html"><i class="fa fa-check"></i><b>1</b> Создаём бота, и отправляем с его помощью сообщения в telegram (1)</a>
<ul>
<li class="chapter" data-level="1.1" data-path="-telegram-1.html"><a href="-telegram-1.html#создание-телеграм-бота"><i class="fa fa-check"></i><b>1.1</b> Создание телеграм бота</a></li>
<li class="chapter" data-level="1.2" data-path="-telegram-1.html"><a href="-telegram-1.html#установка-пакета-для-работы-с-телеграм-ботом-на-r"><i class="fa fa-check"></i><b>1.2</b> Установка пакета для работы с телеграм ботом на R</a></li>
<li class="chapter" data-level="1.3" data-path="-telegram-1.html"><a href="-telegram-1.html#отправка-сообщений-из-r-в-telegram"><i class="fa fa-check"></i><b>1.3</b> Отправка сообщений из R в Telegram</a></li>
<li class="chapter" data-level="1.4" data-path="-telegram-1.html"><a href="-telegram-1.html#как-отправить-в-telegram-таблицу"><i class="fa fa-check"></i><b>1.4</b> Как отправить в telegram таблицу</a></li>
<li class="chapter" data-level="1.5" data-path="-telegram-1.html"><a href="-telegram-1.html#как-добавить-в-сообщение-emoji"><i class="fa fa-check"></i><b>1.5</b> Как добавить в сообщение Emoji</a></li>
<li class="chapter" data-level="1.6" data-path="-telegram-1.html"><a href="-telegram-1.html#проверка-планировщика-задач-windows-и-отправка-уведомления-о-задачах-работа-которых-была-завершена-аварийно"><i class="fa fa-check"></i><b>1.6</b> Проверка планировщика задач Windows, и отправка уведомления о задачах, работа которых была завершена аварийно</a></li>
<li class="chapter" data-level="1.7" data-path="-telegram-1.html"><a href="-telegram-1.html#настраиваем-расписание-запуска-проверки-задач"><i class="fa fa-check"></i><b>1.7</b> Настраиваем расписание запуска проверки задач</a></li>
<li class="chapter" data-level="1.8" data-path="-telegram-1.html"><a href="-telegram-1.html#заключение"><i class="fa fa-check"></i><b>1.8</b> Заключение</a></li>
<li class="chapter" data-level="1.9" data-path="-telegram-1.html"><a href="-telegram-1.html#тесты-и-задания"><i class="fa fa-check"></i><b>1.9</b> Тесты и задания</a>
<ul>
<li class="chapter" data-level="1.9.1" data-path="-telegram-1.html"><a href="-telegram-1.html#тесты"><i class="fa fa-check"></i><b>1.9.1</b> Тесты</a></li>
<li class="chapter" data-level="1.9.2" data-path="-telegram-1.html"><a href="-telegram-1.html#задания"><i class="fa fa-check"></i><b>1.9.2</b> Задания</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="-updater-2.html"><a href="-updater-2.html"><i class="fa fa-check"></i><b>2</b> Добавляем боту поддержку команд и фильтры сообщений, класс Updater (2)</a>
<ul>
<li class="chapter" data-level="2.1" data-path="-updater-2.html"><a href="-updater-2.html#класс-updater"><i class="fa fa-check"></i><b>2.1</b> Класс Updater</a></li>
<li class="chapter" data-level="2.2" data-path="-updater-2.html"><a href="-updater-2.html#handlers---обработчики"><i class="fa fa-check"></i><b>2.2</b> Handlers - обработчики</a></li>
<li class="chapter" data-level="2.3" data-path="-updater-2.html"><a href="-updater-2.html#добавляем-первую-команду-боту-обработчик-команд"><i class="fa fa-check"></i><b>2.3</b> Добавляем первую команду боту, обработчик команд</a></li>
<li class="chapter" data-level="2.4" data-path="-updater-2.html"><a href="-updater-2.html#обработчик-текстовых-сообщений-и-фильтры"><i class="fa fa-check"></i><b>2.4</b> Обработчик текстовых сообщений и фильтры</a></li>
<li class="chapter" data-level="2.5" data-path="-updater-2.html"><a href="-updater-2.html#добавление-команд-с-параметрами"><i class="fa fa-check"></i><b>2.5</b> Добавление команд с параметрами</a></li>
<li class="chapter" data-level="2.6" data-path="-updater-2.html"><a href="-updater-2.html#запускаем-бота-в-фоновом-режиме"><i class="fa fa-check"></i><b>2.6</b> Запускаем бота в фоновом режиме</a></li>
<li class="chapter" data-level="2.7" data-path="-updater-2.html"><a href="-updater-2.html#как-добавить-бота-в-группу"><i class="fa fa-check"></i><b>2.7</b> Как добавить бота в группу</a></li>
<li class="chapter" data-level="2.8" data-path="-updater-2.html"><a href="-updater-2.html#как-добавить-описание-команд-в-интерфейс-бота"><i class="fa fa-check"></i><b>2.8</b> Как добавить описание команд в интерфейс бота</a></li>
<li class="chapter" data-level="2.9" data-path="-updater-2.html"><a href="-updater-2.html#заключение-1"><i class="fa fa-check"></i><b>2.9</b> Заключение</a></li>
<li class="chapter" data-level="2.10" data-path="-updater-2.html"><a href="-updater-2.html#тесты-и-задания-1"><i class="fa fa-check"></i><b>2.10</b> Тесты и задания</a>
<ul>
<li class="chapter" data-level="2.10.1" data-path="-updater-2.html"><a href="-updater-2.html#тесты-1"><i class="fa fa-check"></i><b>2.10.1</b> Тесты</a></li>
<li class="chapter" data-level="2.10.2" data-path="-updater-2.html"><a href="-updater-2.html#задания-1"><i class="fa fa-check"></i><b>2.10.2</b> Задания</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="-3.html"><a href="-3.html"><i class="fa fa-check"></i><b>3</b> Как добавить боту поддержку клавиатуры (3)</a>
<ul>
<li class="chapter" data-level="3.1" data-path="-3.html"><a href="-3.html#какие-типы-клавиатур-поддерживает-телеграм-бот"><i class="fa fa-check"></i><b>3.1</b> Какие типы клавиатур поддерживает телеграм бот</a></li>
<li class="chapter" data-level="3.2" data-path="-3.html"><a href="-3.html#reply-клавиатура"><i class="fa fa-check"></i><b>3.2</b> Reply клавиатура</a></li>
<li class="chapter" data-level="3.3" data-path="-3.html"><a href="-3.html#inline-клавиатура"><i class="fa fa-check"></i><b>3.3</b> Inline клавиатура</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="-3.html"><a href="-3.html#пример-простейшего-бота-с-поддержкой-inline-кнопок"><i class="fa fa-check"></i><b>3.3.1</b> Пример простейшего бота с поддержкой InLine кнопок</a></li>
<li class="chapter" data-level="3.3.2" data-path="-3.html"><a href="-3.html#пример-бота-который-сообщает-текущую-погоду-по-выбранному-городу"><i class="fa fa-check"></i><b>3.3.2</b> Пример бота, который сообщает текущую погоду по выбранному городу</a></li>
<li class="chapter" data-level="3.3.3" data-path="-3.html"><a href="-3.html#пример-бота-который-выводит-список-самых-свежих-статей-со-ссылками-по-указанному-хабу-из-habr.com."><i class="fa fa-check"></i><b>3.3.3</b> Пример бота, который выводит список самых свежих статей со ссылками по-указанному Хабу из <span>habr.com</span>.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="-3.html"><a href="-3.html#заключение-2"><i class="fa fa-check"></i><b>3.4</b> Заключение</a></li>
<li class="chapter" data-level="3.5" data-path="-3.html"><a href="-3.html#тесты-и-задания-2"><i class="fa fa-check"></i><b>3.5</b> Тесты и задания</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="-3.html"><a href="-3.html#тесты-2"><i class="fa fa-check"></i><b>3.5.1</b> Тесты</a></li>
<li class="chapter" data-level="3.5.2" data-path="-3.html"><a href="-3.html#задания-2"><i class="fa fa-check"></i><b>3.5.2</b> Задания</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="-4.html"><a href="-4.html"><i class="fa fa-check"></i><b>4</b> Построение последовательного, логического диалога с ботом (4)</a>
<ul>
<li class="chapter" data-level="4.1" data-path="-4.html"><a href="-4.html#введение-1"><i class="fa fa-check"></i><b>4.1</b> Введение</a></li>
<li class="chapter" data-level="4.2" data-path="-4.html"><a href="-4.html#процесс-построения-бота"><i class="fa fa-check"></i><b>4.2</b> Процесс построения бота</a></li>
<li class="chapter" data-level="4.3" data-path="-4.html"><a href="-4.html#структура-проекта-бота"><i class="fa fa-check"></i><b>4.3</b> Структура проекта бота</a></li>
<li class="chapter" data-level="4.4" data-path="-4.html"><a href="-4.html#конфиг-бота"><i class="fa fa-check"></i><b>4.4</b> Конфиг бота</a></li>
<li class="chapter" data-level="4.5" data-path="-4.html"><a href="-4.html#создаём-переменную-среды"><i class="fa fa-check"></i><b>4.5</b> Создаём переменную среды</a></li>
<li class="chapter" data-level="4.6" data-path="-4.html"><a href="-4.html#создаём-базу-данных"><i class="fa fa-check"></i><b>4.6</b> Создаём базу данных</a></li>
<li class="chapter" data-level="4.7" data-path="-4.html"><a href="-4.html#пишем-функции-для-работы-с-базой-данных"><i class="fa fa-check"></i><b>4.7</b> Пишем функции для работы с базой данных</a></li>
<li class="chapter" data-level="4.8" data-path="-4.html"><a href="-4.html#методы-бота"><i class="fa fa-check"></i><b>4.8</b> Методы бота</a></li>
<li class="chapter" data-level="4.9" data-path="-4.html"><a href="-4.html#фильтры-сообщений"><i class="fa fa-check"></i><b>4.9</b> Фильтры сообщений</a></li>
<li class="chapter" data-level="4.10" data-path="-4.html"><a href="-4.html#обработчики"><i class="fa fa-check"></i><b>4.10</b> Обработчики</a></li>
<li class="chapter" data-level="4.11" data-path="-4.html"><a href="-4.html#код-запуска-бота"><i class="fa fa-check"></i><b>4.11</b> Код запуска бота</a></li>
<li class="chapter" data-level="4.12" data-path="-4.html"><a href="-4.html#заключение-3"><i class="fa fa-check"></i><b>4.12</b> Заключение</a></li>
<li class="chapter" data-level="4.13" data-path="-4.html"><a href="-4.html#тесты-и-задания-3"><i class="fa fa-check"></i><b>4.13</b> Тесты и задания</a>
<ul>
<li class="chapter" data-level="4.13.1" data-path="-4.html"><a href="-4.html#тесты-3"><i class="fa fa-check"></i><b>4.13.1</b> Тесты</a></li>
<li class="chapter" data-level="4.13.2" data-path="-4.html"><a href="-4.html#задания-3"><i class="fa fa-check"></i><b>4.13.2</b> Задания</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="-5.html"><a href="-5.html"><i class="fa fa-check"></i><b>5</b> Управление правами пользователей бота (5)</a>
<ul>
<li class="chapter" data-level="5.1" data-path="-5.html"><a href="-5.html#введение-2"><i class="fa fa-check"></i><b>5.1</b> Введение</a></li>
<li class="chapter" data-level="5.2" data-path="-5.html"><a href="-5.html#ограничиваем-права-пользователя-с-помощью-фильтров-сообщений"><i class="fa fa-check"></i><b>5.2</b> Ограничиваем права пользователя с помощью фильтров сообщений</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="-5.html"><a href="-5.html#ограничиваем-права-на-уровне-имени-пользователя"><i class="fa fa-check"></i><b>5.2.1</b> Ограничиваем права на уровне имени пользователя</a></li>
<li class="chapter" data-level="5.2.2" data-path="-5.html"><a href="-5.html#ограничиваем-права-на-уровне-чата"><i class="fa fa-check"></i><b>5.2.2</b> Ограничиваем права на уровне чата</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="-5.html"><a href="-5.html#ограничиваем-права-пользователя-внутри-кода-методов"><i class="fa fa-check"></i><b>5.3</b> Ограничиваем права пользователя внутри кода методов</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="-5.html"><a href="-5.html#ограничиваем-права-на-уровне-имени-пользователя-1"><i class="fa fa-check"></i><b>5.3.1</b> Ограничиваем права на уровне имени пользователя</a></li>
<li class="chapter" data-level="5.3.2" data-path="-5.html"><a href="-5.html#ограничиваем-права-на-уровне-чата-1"><i class="fa fa-check"></i><b>5.3.2</b> Ограничиваем права на уровне чата</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="-5.html"><a href="-5.html#заключение-4"><i class="fa fa-check"></i><b>5.4</b> Заключение</a></li>
<li class="chapter" data-level="5.5" data-path="-5.html"><a href="-5.html#тесты-и-задания-4"><i class="fa fa-check"></i><b>5.5</b> Тесты и задания</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="-5.html"><a href="-5.html#тесты-4"><i class="fa fa-check"></i><b>5.5.1</b> Тесты</a></li>
<li class="chapter" data-level="5.5.2" data-path="-5.html"><a href="-5.html#задания-4"><i class="fa fa-check"></i><b>5.5.2</b> Задания</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="-6.html"><a href="-6.html"><i class="fa fa-check"></i><b>6</b> Повышаем стабильность работы бота (6)</a>
<ul>
<li class="chapter" data-level="6.1" data-path="-6.html"><a href="-6.html#конструкция-trycatch"><i class="fa fa-check"></i><b>6.1</b> Конструкция tryCatch()</a></li>
<li class="chapter" data-level="6.2" data-path="-6.html"><a href="-6.html#логика-работы-конструкции-trycatch"><i class="fa fa-check"></i><b>6.2</b> Логика работы конструкции tryCatch()</a></li>
<li class="chapter" data-level="6.3" data-path="-6.html"><a href="-6.html#используем-trycatch-внутри-бота"><i class="fa fa-check"></i><b>6.3</b> Используем tryCatch() внутри бота</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="-tasks.html"><a href="-tasks.html"><i class="fa fa-check"></i>Решение задач (tasks)</a>
<ul>
<li class="chapter" data-level="" data-path="-tasks.html"><a href="-tasks.html#задача-1.1"><i class="fa fa-check"></i>Задача 1.1</a></li>
<li class="chapter" data-level="" data-path="-tasks.html"><a href="-tasks.html#задача-2.1"><i class="fa fa-check"></i>Задача 2.1</a></li>
<li class="chapter" data-level="" data-path="-tasks.html"><a href="-tasks.html#задача-3.1"><i class="fa fa-check"></i>Задача 3.1</a></li>
<li class="chapter" data-level="" data-path="-tasks.html"><a href="-tasks.html#задача-4.1"><i class="fa fa-check"></i>Задача 4.1</a></li>
<li class="chapter" data-level="" data-path="-tasks.html"><a href="-tasks.html#задача-5.1"><i class="fa fa-check"></i>Задача 5.1</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://t.me/R4marketing" target="blank">Канал R4marketing</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Разработка telegram ботов на языке R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="создаём-бота-и-отправляем-с-его-помощью-сообщения-в-telegram-1" class="section level1" number="1">
<h1><span class="header-section-number">Глава 1</span> Создаём бота, и отправляем с его помощью сообщения в telegram (1)</h1>
<p><img src="https://habrastorage.org/webt/mz/ef/op/mzefopqcvltbomddoh8pmx45hzc.png" align="center" width="80%" /></p>
<p>В этой главе мы разберёмся как создать телеграм бота, и отправлять с его помощью уведомления в telegram.</p>
<div id="создание-телеграм-бота" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> Создание телеграм бота</h2>
<p>Для начала нам необходимо создать бота. Делается это с помощью специального бота <strong>BotFather</strong>, переходим по <a href="https://t.me/BotFather">ссылке</a> и пишем боту <code>/start</code>.</p>
<p>После чего вы получите сообщение со списком команд:</p>
<pre><code>I can help you create and manage Telegram bots. If you&#39;re new to the Bot API, please see the manual (https://core.telegram.org/bots).

You can control me by sending these commands:

/newbot - create a new bot
/mybots - edit your bots [beta]

Edit Bots
/setname - change a bot&#39;s name
/setdescription - change bot description
/setabouttext - change bot about info
/setuserpic - change bot profile photo
/setcommands - change the list of commands
/deletebot - delete a bot

Bot Settings
/token - generate authorization token
/revoke - revoke bot access token
/setinline - toggle inline mode (https://core.telegram.org/bots/inline)
/setinlinegeo - toggle inline location requests (https://core.telegram.org/bots/inline#location-based-results)
/setinlinefeedback - change inline feedback (https://core.telegram.org/bots/inline#collecting-feedback) settings
/setjoingroups - can your bot be added to groups?
/setprivacy - toggle privacy mode (https://core.telegram.org/bots#privacy-mode) in groups

Games
/mygames - edit your games (https://core.telegram.org/bots/games) [beta]
/newgame - create a new game (https://core.telegram.org/bots/games)
/listgames - get a list of your games
/editgame - edit a game
/deletegame - delete an existing game</code></pre>
<p>Для создания нового бота отправляем команду <code>/newbot</code>.</p>
<p>BotFather попросит вас ввести имя и логин бота.</p>
<pre><code>BotFather, [25.07.20 09:39]
Alright, a new bot. How are we going to call it? Please choose a name for your bot.

Alexey Seleznev, [25.07.20 09:40]
My Test Bot

BotFather, [25.07.20 09:40]
Good. Now let&#39;s choose a username for your bot. It must end in `bot`. Like this, for example: TetrisBot or tetris_bot.

Alexey Seleznev, [25.07.20 09:40]
@my_test_bot</code></pre>
<p>Имя вы можете ввести произвольное, а логин должен заканчиваться на <code>bot</code>.</p>
<p>Если вы всё сделали правильно, то получите следующее сообщение:</p>
<pre><code>Done! Congratulations on your new bot. You will find it at t.me/my_test_bot. You can now add a description, about section and profile picture for your bot, see /help for a list of commands. By the way, when you&#39;ve finished creating your cool bot, ping our Bot Support if you want a better username for it. Just make sure the bot is fully operational before you do this.

Use this token to access the HTTP API:
123456789:abcdefghijklmnopqrstuvwxyz

For a description of the Bot API, see this page: https://core.telegram.org/bots/api</code></pre>
<p>Далее вам понадобится полученный API токен, в моём примере это <code>123456789:abcdefghijklmnopqrstuvwxyz</code>.</p>
<p>Более подробно о возможностях <strong>BotFather</strong> можно узнать из <a href="https://botcreators.ru/blog/botfather-instrukciya/">этой публикации</a>. На этом шаге подготовительные работы по созданию бота завершены.</p>
</div>
<div id="установка-пакета-для-работы-с-телеграм-ботом-на-r" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Установка пакета для работы с телеграм ботом на R</h2>
<p>Я предполагаю, что у вас уже установлен язык R, и среда разработки RStudio. Если это не так, то вы можете посмотреть данный <a href="https://youtu.be/wFUoaeGEMmY">видео урок</a> о том, как их установить.</p>
<p>Для работы с Telegram Bot API мы будем использовать R пакет <a href="https://CRAN.R-project.org/package=telegram.bot">telegram.bot</a>.</p>
<p>Установка пакетов в R осуществляется функцией <code>install.packages()</code>, поэтому для установки нужного нам пакета используйте команду <code>install.packages("telegram.bot")</code>.</p>
<p>Более подробно узнать об установке различных пакетов можно из <a href="https://youtu.be/1UvrWoZugic">этого видео</a>.</p>
<p>После установки пакета его необходимо подключить:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="-telegram-1.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(telegram.bot)</span></code></pre></div>
</div>
<div id="отправка-сообщений-из-r-в-telegram" class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> Отправка сообщений из R в Telegram</h2>
<p>Созданного вами бота можно найти в Telegram по заданному при создании логину, в моём случае это <code>@my_test_bot</code>.</p>
<p>Отправьте боту любое сообщение, например “Привет бот.” На данный момент это нам надо для того, что бы получить id вашего с ботом чата.</p>
<p>Теперь в R пишем следующий код.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="-telegram-1.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(telegram.bot)</span>
<span id="cb5-2"><a href="-telegram-1.html#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="-telegram-1.html#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># создаём экземпляр бота</span></span>
<span id="cb5-4"><a href="-telegram-1.html#cb5-4" aria-hidden="true" tabindex="-1"></a>bot <span class="ot">&lt;-</span> <span class="fu">Bot</span>(<span class="at">token =</span> <span class="st">&quot;123456789:abcdefghijklmnopqrstuvwxyz&quot;</span>)</span>
<span id="cb5-5"><a href="-telegram-1.html#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="-telegram-1.html#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Запрашиваем информацию о боте</span></span>
<span id="cb5-7"><a href="-telegram-1.html#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(bot<span class="sc">$</span><span class="fu">getMe</span>())</span>
<span id="cb5-8"><a href="-telegram-1.html#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="-telegram-1.html#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Получаем обновления бота, т.е. список отправленных ему сообщений</span></span>
<span id="cb5-10"><a href="-telegram-1.html#cb5-10" aria-hidden="true" tabindex="-1"></a>updates <span class="ot">&lt;-</span> bot<span class="sc">$</span><span class="fu">getUpdates</span>()</span>
<span id="cb5-11"><a href="-telegram-1.html#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="-telegram-1.html#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Запрашиваем идентификатор чата</span></span>
<span id="cb5-13"><a href="-telegram-1.html#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Примечание: перед запросом обновлений вы должны отправить боту сообщение</span></span>
<span id="cb5-14"><a href="-telegram-1.html#cb5-14" aria-hidden="true" tabindex="-1"></a>chat_id <span class="ot">&lt;-</span> updates[[1L]]<span class="sc">$</span><span class="fu">from_chat_id</span>()</span></code></pre></div>
<p>Изначально мы создаём экземпляр нашего бота функцией <code>Bot()</code>, в качестве аргумента в неё необходимо передать полученный ранее токен.</p>
<p>Хранить токен в коде считается не лучшей практикой, поэтому вы можете хранить его в переменной среды, и считывать его из неё. По умолчанию в пакете <code>telegram.bot</code> реализована поддержка переменных среды следующего наименования: <code>R_TELEGRAM_BOT_ИМЯ_ВАШЕГО_БОТА</code>. Вместо <code>ИМЯ_ВАШЕГО_БОТА</code> подставьте имя которое вы задали при создании, в моём случае будет переменная <code>R_TELEGRAM_BOT_My Test Bot</code>.</p>
<p>Создать переменную среды можно несколькими способами, я расскажу о наиболее универсальном и кроссплатформенном. Создайте в вашей домашней директории (узнать её можно с помощью команды <code>path.expand("~")</code>) текстовый файл с названием <em>.Renviron</em>. Сделать это также можно с помощью команды <code>file.edit(path.expand(file.path("~", ".Renviron")))</code>.</p>
<p>И добавьте в него следующую строку.</p>
<pre><code>R_TELEGRAM_BOT_ИМЯ_ВАШЕГО_БОТА=123456789:abcdefghijklmnopqrstuvwxyz</code></pre>
<p>Далее вы можете использовать сохранённый в переменной среды токен с помощью функции <code>bot_token()</code>, т.е. вот так:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="-telegram-1.html#cb7-1" aria-hidden="true" tabindex="-1"></a>bot <span class="ot">&lt;-</span> <span class="fu">Bot</span>(<span class="at">token =</span> <span class="fu">bot_token</span>(<span class="st">&quot;My Test Bot&quot;</span>))</span></code></pre></div>
<p>Метод <code>getUpdates()</code>позволяет нам получить обновления бота, т.е. сообщения которые были ему отправлены. Метод <code>from_chat_id()</code>, позволяет получить идентификатор чата, из которого было отправлено сообщение. Этот идентификатор нам нужен для отправки сообщений от бота.</p>
<p>Помимо id чата из объекта полученного методом <code>getUpdates()</code> вы получаете и некоторую другую полезную информацию. Например, информацию о пользователе, отправившем сообщение.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="-telegram-1.html#cb8-1" aria-hidden="true" tabindex="-1"></a>updates[[1L]]<span class="sc">$</span>message<span class="sc">$</span>from</span></code></pre></div>
<pre><code>$id
[1] 000000000

$is_bot
[1] FALSE

$first_name
[1] &quot;Alexey&quot;

$last_name
[1] &quot;Seleznev&quot;

$username
[1] &quot;AlexeySeleznev&quot;

$language_code
[1] &quot;ru&quot;</code></pre>
<p>Итак, на данном этапе у нас уже есть всё, что необходимо для отправки сообщения от бота в телеграм. Воспользуемся методом <code>sendMessage()</code>, в который необходимо передать идентификатор чата, текст сообщения, и тип разметки текста сообщения. Тип разметки может быть Markdown или HTML и устанавливается аргументом <code>parse_mode</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="-telegram-1.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Отправка сообщения</span></span>
<span id="cb10-2"><a href="-telegram-1.html#cb10-2" aria-hidden="true" tabindex="-1"></a>bot<span class="sc">$</span><span class="fu">sendMessage</span>(chat_id,</span>
<span id="cb10-3"><a href="-telegram-1.html#cb10-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">text =</span> <span class="st">&quot;Привет, *жирный текст* _курсив_&quot;</span>,</span>
<span id="cb10-4"><a href="-telegram-1.html#cb10-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">parse_mode =</span> <span class="st">&quot;Markdown&quot;</span></span>
<span id="cb10-5"><a href="-telegram-1.html#cb10-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Если вам необходимо отправить сообщение от бота не в чат, а в публичный канал, то в <code>chat_id</code> указывайте адрс вашего канала, например <code>'@MyTGChannel'</code>.</p>
<p>При необходимости отправить сообщение в приватный канал, вам необходимо скопировать ссылку на любое сообщение данного канала, из ссылки получить его идентификатор, и к этому идентификатору добавить -100.</p>
<p><img src="http://img.netpeak.ua/alsey/1JA922T.png" /></p>
<p>Пример ссылки приватного канала: <a href="https://t.me/c/012345678/11" class="uri">https://t.me/c/012345678/11</a></p>
<p>Соответвенно, к id 012345678 вам необходимо добавить -100, в таком случае в <code>chat_id</code> надо указать -100012345678.</p>
<p><strong>Основы форматирования Markdown разметки:</strong></p>
<ul>
<li>Жирный шрифт выделяется с помощью знака *:
<ul>
<li>пример: <code>*жирный шритф*</code></li>
<li>результат: <strong>жирный шритф</strong></li>
</ul></li>
<li>Курсив задаётся нижним подчёркиванием:
<ul>
<li>пример: <code>_курсив_</code></li>
<li>результат: <em>курсив</em></li>
</ul></li>
<li>Моноширинный шрифт, которым обычно выделяется программный код, задаётся с помощью апострофов:
<ul>
<li>пример: `моноширинный шрифт`</li>
<li>результат: <code>моноширинный шрифт</code></li>
</ul></li>
</ul>
<p><strong>Основы форматирования HTML разметки:</strong></p>
<p>В HTML вы заворачиваете часть текста, которую надо выделать, в теги, пример <code>&lt;тег&gt;текст&lt;/тег&gt;</code>.</p>
<ul>
<li><code>&lt;тег&gt;</code> - открывающий тег</li>
<li><code>&lt;/тег&gt;</code> - закрывающий тег</li>
</ul>
<p><strong>Теги HTML разметки</strong></p>
<ul>
<li><code>&lt;b&gt;</code> - жирный шрифт
<ul>
<li>пример: <code>&lt;b&gt;жирный шрифт&lt;/b&gt;</code></li>
<li>результат <strong>жирный шрифт</strong></li>
</ul></li>
<li><code>&lt;i&gt;</code> - курсив
<ul>
<li>пример: <code>&lt;i&gt;курсив&lt;/i&gt;</code></li>
<li>результат: <em>курсив</em></li>
</ul></li>
<li><code>&lt;code&gt;</code> - моноширинный шрифт
<ul>
<li>пример: <code>&lt;code\&gt;моноширинный шрифт&lt;/code\&gt;</code></li>
<li>результат: <code>моноширинный шрифт</code></li>
</ul></li>
</ul>
<p>Помимо текста вы можете отправлять и другой контент используя специальные методы:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="-telegram-1.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Отправить изображение</span></span>
<span id="cb11-2"><a href="-telegram-1.html#cb11-2" aria-hidden="true" tabindex="-1"></a>bot<span class="sc">$</span><span class="fu">sendPhoto</span>(chat_id,</span>
<span id="cb11-3"><a href="-telegram-1.html#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">photo =</span> <span class="st">&quot;https://telegram.org/img/t_logo.png&quot;</span></span>
<span id="cb11-4"><a href="-telegram-1.html#cb11-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-5"><a href="-telegram-1.html#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="-telegram-1.html#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Отправка голосового сообщения</span></span>
<span id="cb11-7"><a href="-telegram-1.html#cb11-7" aria-hidden="true" tabindex="-1"></a>bot<span class="sc">$</span><span class="fu">sendAudio</span>(chat_id,</span>
<span id="cb11-8"><a href="-telegram-1.html#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">audio =</span> <span class="st">&quot;http://www.largesound.com/ashborytour/sound/brobob.mp3&quot;</span></span>
<span id="cb11-9"><a href="-telegram-1.html#cb11-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-10"><a href="-telegram-1.html#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="-telegram-1.html#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Отправить документ</span></span>
<span id="cb11-12"><a href="-telegram-1.html#cb11-12" aria-hidden="true" tabindex="-1"></a>bot<span class="sc">$</span><span class="fu">sendDocument</span>(chat_id,</span>
<span id="cb11-13"><a href="-telegram-1.html#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">document =</span> <span class="st">&quot;https://github.com/ebeneditos/telegram.bot/raw/gh-pages/docs/telegram.bot.pdf&quot;</span></span>
<span id="cb11-14"><a href="-telegram-1.html#cb11-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-15"><a href="-telegram-1.html#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="-telegram-1.html#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Отправить стикер</span></span>
<span id="cb11-17"><a href="-telegram-1.html#cb11-17" aria-hidden="true" tabindex="-1"></a>bot<span class="sc">$</span><span class="fu">sendSticker</span>(chat_id,</span>
<span id="cb11-18"><a href="-telegram-1.html#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">sticker =</span> <span class="st">&quot;https://www.gstatic.com/webp/gallery/1.webp&quot;</span></span>
<span id="cb11-19"><a href="-telegram-1.html#cb11-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-20"><a href="-telegram-1.html#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="-telegram-1.html#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Отправить видео</span></span>
<span id="cb11-22"><a href="-telegram-1.html#cb11-22" aria-hidden="true" tabindex="-1"></a>bot<span class="sc">$</span><span class="fu">sendVideo</span>(chat_id,</span>
<span id="cb11-23"><a href="-telegram-1.html#cb11-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">video =</span> <span class="st">&quot;http://techslides.com/demos/sample-videos/small.mp4&quot;</span></span>
<span id="cb11-24"><a href="-telegram-1.html#cb11-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-25"><a href="-telegram-1.html#cb11-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-26"><a href="-telegram-1.html#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Отправить gif анимацию</span></span>
<span id="cb11-27"><a href="-telegram-1.html#cb11-27" aria-hidden="true" tabindex="-1"></a>bot<span class="sc">$</span><span class="fu">sendAnimation</span>(chat_id,</span>
<span id="cb11-28"><a href="-telegram-1.html#cb11-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">animation =</span> <span class="st">&quot;https://media.giphy.com/media/sIIhZliB2McAo/giphy.gif&quot;</span></span>
<span id="cb11-29"><a href="-telegram-1.html#cb11-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-30"><a href="-telegram-1.html#cb11-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-31"><a href="-telegram-1.html#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Отправить локацию</span></span>
<span id="cb11-32"><a href="-telegram-1.html#cb11-32" aria-hidden="true" tabindex="-1"></a>bot<span class="sc">$</span><span class="fu">sendLocation</span>(chat_id,</span>
<span id="cb11-33"><a href="-telegram-1.html#cb11-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">latitude =</span> <span class="fl">51.521727</span>,</span>
<span id="cb11-34"><a href="-telegram-1.html#cb11-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">longitude =</span> <span class="sc">-</span><span class="fl">0.117255</span></span>
<span id="cb11-35"><a href="-telegram-1.html#cb11-35" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-36"><a href="-telegram-1.html#cb11-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-37"><a href="-telegram-1.html#cb11-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Имитация действия в чате</span></span>
<span id="cb11-38"><a href="-telegram-1.html#cb11-38" aria-hidden="true" tabindex="-1"></a>bot<span class="sc">$</span><span class="fu">sendChatAction</span>(chat_id,</span>
<span id="cb11-39"><a href="-telegram-1.html#cb11-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">action =</span> <span class="st">&quot;typing&quot;</span></span>
<span id="cb11-40"><a href="-telegram-1.html#cb11-40" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Т.е. например с помощью метода <code>sendPhoto()</code> вы можете отправить сохранённый в виде изображения график, который вы построили с помощью пакета <code>ggplot2</code>.</p>
</div>
<div id="как-отправить-в-telegram-таблицу" class="section level2" number="1.4">
<h2><span class="header-section-number">1.4</span> Как отправить в telegram таблицу</h2>
<p>К сожалению на момент написания книги telegram не поддерживает полноценные таблицы в HTML или Markdown, но вы можете иметировать подобие таблицы. Для этого воспользуйтесь кодом представленной ниже функции <code>to_tg_table()</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="-telegram-1.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb12-2"><a href="-telegram-1.html#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb12-3"><a href="-telegram-1.html#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb12-4"><a href="-telegram-1.html#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="-telegram-1.html#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># функция для перевода data.frame в telegram таблицу </span></span>
<span id="cb12-6"><a href="-telegram-1.html#cb12-6" aria-hidden="true" tabindex="-1"></a>to_tg_table <span class="ot">&lt;-</span> <span class="cf">function</span>( table, <span class="at">align =</span> <span class="cn">NULL</span>, <span class="at">indents =</span> <span class="dv">3</span>, <span class="at">parse_mode =</span> <span class="st">&#39;Markdown&#39;</span> ) {</span>
<span id="cb12-7"><a href="-telegram-1.html#cb12-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-8"><a href="-telegram-1.html#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># если выравнивание не задано то выравниваем по левому краю</span></span>
<span id="cb12-9"><a href="-telegram-1.html#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> ( <span class="fu">is.null</span>(align) ) {</span>
<span id="cb12-10"><a href="-telegram-1.html#cb12-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-11"><a href="-telegram-1.html#cb12-11" aria-hidden="true" tabindex="-1"></a>    col_num <span class="ot">&lt;-</span> <span class="fu">length</span>(table)</span>
<span id="cb12-12"><a href="-telegram-1.html#cb12-12" aria-hidden="true" tabindex="-1"></a>    align   <span class="ot">&lt;-</span> <span class="fu">str_c</span>( <span class="fu">rep</span>(<span class="st">&#39;l&#39;</span>, col_num), <span class="at">collapse =</span> <span class="st">&#39;&#39;</span> )</span>
<span id="cb12-13"><a href="-telegram-1.html#cb12-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-14"><a href="-telegram-1.html#cb12-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-15"><a href="-telegram-1.html#cb12-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-16"><a href="-telegram-1.html#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># проверяем правильно ли заданно выравнивание</span></span>
<span id="cb12-17"><a href="-telegram-1.html#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> ( <span class="fu">length</span>(table) <span class="sc">!=</span> <span class="fu">nchar</span>(align) ) {</span>
<span id="cb12-18"><a href="-telegram-1.html#cb12-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-19"><a href="-telegram-1.html#cb12-19" aria-hidden="true" tabindex="-1"></a>    align <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb12-20"><a href="-telegram-1.html#cb12-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-21"><a href="-telegram-1.html#cb12-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-22"><a href="-telegram-1.html#cb12-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-23"><a href="-telegram-1.html#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># новое выравнивание столбцов </span></span>
<span id="cb12-24"><a href="-telegram-1.html#cb12-24" aria-hidden="true" tabindex="-1"></a>  side <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nchar</span>(align), </span>
<span id="cb12-25"><a href="-telegram-1.html#cb12-25" aria-hidden="true" tabindex="-1"></a>         <span class="cf">function</span>(x) { </span>
<span id="cb12-26"><a href="-telegram-1.html#cb12-26" aria-hidden="true" tabindex="-1"></a>           letter <span class="ot">&lt;-</span> <span class="fu">substr</span>(align, x, x)</span>
<span id="cb12-27"><a href="-telegram-1.html#cb12-27" aria-hidden="true" tabindex="-1"></a>           <span class="cf">switch</span> (letter,</span>
<span id="cb12-28"><a href="-telegram-1.html#cb12-28" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&#39;l&#39;</span> <span class="ot">=</span> <span class="st">&#39;right&#39;</span>,</span>
<span id="cb12-29"><a href="-telegram-1.html#cb12-29" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&#39;r&#39;</span> <span class="ot">=</span> <span class="st">&#39;left&#39;</span>,</span>
<span id="cb12-30"><a href="-telegram-1.html#cb12-30" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&#39;c&#39;</span> <span class="ot">=</span> <span class="st">&#39;both&#39;</span>,</span>
<span id="cb12-31"><a href="-telegram-1.html#cb12-31" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&#39;left&#39;</span></span>
<span id="cb12-32"><a href="-telegram-1.html#cb12-32" aria-hidden="true" tabindex="-1"></a>           )</span>
<span id="cb12-33"><a href="-telegram-1.html#cb12-33" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb12-34"><a href="-telegram-1.html#cb12-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-35"><a href="-telegram-1.html#cb12-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># сохраняем имена</span></span>
<span id="cb12-36"><a href="-telegram-1.html#cb12-36" aria-hidden="true" tabindex="-1"></a>  t_names      <span class="ot">&lt;-</span> <span class="fu">names</span>(table)</span>
<span id="cb12-37"><a href="-telegram-1.html#cb12-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-38"><a href="-telegram-1.html#cb12-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># вычисляем ширину столбцов</span></span>
<span id="cb12-39"><a href="-telegram-1.html#cb12-39" aria-hidden="true" tabindex="-1"></a>  names_length <span class="ot">&lt;-</span> <span class="fu">sapply</span>(t_names, nchar) </span>
<span id="cb12-40"><a href="-telegram-1.html#cb12-40" aria-hidden="true" tabindex="-1"></a>  value_length <span class="ot">&lt;-</span> <span class="fu">sapply</span>(table, <span class="cf">function</span>(x) <span class="fu">max</span>(<span class="fu">nchar</span>(<span class="fu">as.character</span>(x))))</span>
<span id="cb12-41"><a href="-telegram-1.html#cb12-41" aria-hidden="true" tabindex="-1"></a>  max_length   <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(value_length <span class="sc">&gt;</span> names_length, value_length, names_length)</span>
<span id="cb12-42"><a href="-telegram-1.html#cb12-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-43"><a href="-telegram-1.html#cb12-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># подгоняем размер имён столбцов под их ширину + указанное в indents к-во пробелов </span></span>
<span id="cb12-44"><a href="-telegram-1.html#cb12-44" aria-hidden="true" tabindex="-1"></a>  t_names <span class="ot">&lt;-</span> <span class="fu">mapply</span>(str_pad, </span>
<span id="cb12-45"><a href="-telegram-1.html#cb12-45" aria-hidden="true" tabindex="-1"></a>                    <span class="at">string =</span> t_names, </span>
<span id="cb12-46"><a href="-telegram-1.html#cb12-46" aria-hidden="true" tabindex="-1"></a>                    <span class="at">width  =</span> max_length <span class="sc">+</span> indents, </span>
<span id="cb12-47"><a href="-telegram-1.html#cb12-47" aria-hidden="true" tabindex="-1"></a>                    <span class="at">side   =</span> side)</span>
<span id="cb12-48"><a href="-telegram-1.html#cb12-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-49"><a href="-telegram-1.html#cb12-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># объединяем названия столбцов</span></span>
<span id="cb12-50"><a href="-telegram-1.html#cb12-50" aria-hidden="true" tabindex="-1"></a>  str_names <span class="ot">&lt;-</span> <span class="fu">str_c</span>(t_names, <span class="at">collapse =</span> <span class="st">&#39;&#39;</span>)</span>
<span id="cb12-51"><a href="-telegram-1.html#cb12-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-52"><a href="-telegram-1.html#cb12-52" aria-hidden="true" tabindex="-1"></a>  <span class="co"># аргументы для фукнции str_pad</span></span>
<span id="cb12-53"><a href="-telegram-1.html#cb12-53" aria-hidden="true" tabindex="-1"></a>  rules <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">string =</span> table, <span class="at">width =</span> max_length <span class="sc">+</span> indents, <span class="at">side =</span> side)</span>
<span id="cb12-54"><a href="-telegram-1.html#cb12-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-55"><a href="-telegram-1.html#cb12-55" aria-hidden="true" tabindex="-1"></a>  <span class="co"># поочереди переводим каждый столбец к нужному виду</span></span>
<span id="cb12-56"><a href="-telegram-1.html#cb12-56" aria-hidden="true" tabindex="-1"></a>  t_str <span class="ot">&lt;-</span>   <span class="fu">pmap_df</span>( rules, str_pad )<span class="sc">%&gt;%</span></span>
<span id="cb12-57"><a href="-telegram-1.html#cb12-57" aria-hidden="true" tabindex="-1"></a>              <span class="fu">unite</span>(<span class="st">&quot;data&quot;</span>, <span class="fu">everything</span>(), <span class="at">remove =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">&#39;&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-58"><a href="-telegram-1.html#cb12-58" aria-hidden="true" tabindex="-1"></a>              <span class="fu">unlist</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb12-59"><a href="-telegram-1.html#cb12-59" aria-hidden="true" tabindex="-1"></a>              <span class="fu">str_c</span>(<span class="at">collapse =</span> <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>) </span>
<span id="cb12-60"><a href="-telegram-1.html#cb12-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-61"><a href="-telegram-1.html#cb12-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># если таблица занимает более 4096 символов обрезаем её</span></span>
<span id="cb12-62"><a href="-telegram-1.html#cb12-62" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> ( <span class="fu">nchar</span>(t_str) <span class="sc">&gt;=</span> <span class="dv">4021</span> ) {</span>
<span id="cb12-63"><a href="-telegram-1.html#cb12-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-64"><a href="-telegram-1.html#cb12-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="st">&#39;Таблица составляет более 4096 символов!&#39;</span>)</span>
<span id="cb12-65"><a href="-telegram-1.html#cb12-65" aria-hidden="true" tabindex="-1"></a>    t_str <span class="ot">&lt;-</span> <span class="fu">substr</span>(t_str, <span class="dv">1</span>, <span class="dv">4021</span>)</span>
<span id="cb12-66"><a href="-telegram-1.html#cb12-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-67"><a href="-telegram-1.html#cb12-67" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-68"><a href="-telegram-1.html#cb12-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-69"><a href="-telegram-1.html#cb12-69" aria-hidden="true" tabindex="-1"></a>  <span class="co"># символы выделения блока кода согласно выбранной разметке</span></span>
<span id="cb12-70"><a href="-telegram-1.html#cb12-70" aria-hidden="true" tabindex="-1"></a>  code_block <span class="ot">&lt;-</span> <span class="cf">switch</span>(parse_mode, </span>
<span id="cb12-71"><a href="-telegram-1.html#cb12-71" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&#39;Markdown&#39;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;```&#39;</span>, <span class="st">&#39;```&#39;</span>),</span>
<span id="cb12-72"><a href="-telegram-1.html#cb12-72" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&#39;HTML&#39;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;&lt;code&gt;&#39;</span>, <span class="st">&#39;&lt;/code&gt;&#39;</span>))</span>
<span id="cb12-73"><a href="-telegram-1.html#cb12-73" aria-hidden="true" tabindex="-1"></a>           </span>
<span id="cb12-74"><a href="-telegram-1.html#cb12-74" aria-hidden="true" tabindex="-1"></a>  <span class="co"># переводим в code</span></span>
<span id="cb12-75"><a href="-telegram-1.html#cb12-75" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">str_c</span>(code_block[<span class="dv">1</span>], str_names, t_str, code_block[<span class="dv">2</span>], <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>)</span>
<span id="cb12-76"><a href="-telegram-1.html#cb12-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-77"><a href="-telegram-1.html#cb12-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(res)</span>
<span id="cb12-78"><a href="-telegram-1.html#cb12-78" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>С помощью этой функци вы можете преобразовать любой data.frame и отправить в telegram:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="-telegram-1.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># преобразуем таблицу iris </span></span>
<span id="cb13-2"><a href="-telegram-1.html#cb13-2" aria-hidden="true" tabindex="-1"></a>tg_table <span class="ot">&lt;-</span> <span class="fu">to_tg_table</span>( <span class="fu">head</span>(iris, <span class="dv">15</span>) )</span>
<span id="cb13-3"><a href="-telegram-1.html#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="-telegram-1.html#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># отправляем таблицу в telegram</span></span>
<span id="cb13-5"><a href="-telegram-1.html#cb13-5" aria-hidden="true" tabindex="-1"></a>bot<span class="sc">$</span><span class="fu">sendMessage</span>(<span class="dv">194336771</span>, </span>
<span id="cb13-6"><a href="-telegram-1.html#cb13-6" aria-hidden="true" tabindex="-1"></a>                tg_table,</span>
<span id="cb13-7"><a href="-telegram-1.html#cb13-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;Markdown&quot;</span>)</span></code></pre></div>
<p>В telegram это буедет выглядеть так:
<img src="http://img.netpeak.ua/alsey/160295135597_kiss_150kb.png" /></p>
<p>У функции <code>to_tg_table()</code> есть несколько дополнительных аргументов:</p>
<ul>
<li>align - выравнивнивание столбцов, тектовая строка, каждая буква соответвует одному столбцу, пример <code>'llrrc'</code>:
<ul>
<li>l - выравнивание по левой стороне</li>
<li>r - выравнивание по правой стороне</li>
<li>c - выравнивание по центру</li>
</ul></li>
<li>indents - количество пробелов для разделения столбцов.</li>
<li>parse_mode - разметка сообщения, Markdown или HTML.</li>
</ul>
<p>Пример с выравниванием столбцов:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="-telegram-1.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># преобразуем таблицу iris </span></span>
<span id="cb14-2"><a href="-telegram-1.html#cb14-2" aria-hidden="true" tabindex="-1"></a>tg_table <span class="ot">&lt;-</span> <span class="fu">to_tg_table</span>( <span class="fu">head</span>(iris, <span class="dv">15</span>), </span>
<span id="cb14-3"><a href="-telegram-1.html#cb14-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">align =</span> <span class="st">&#39;llccr&#39;</span>)</span>
<span id="cb14-4"><a href="-telegram-1.html#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="-telegram-1.html#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># отправляем таблицу в telegram</span></span>
<span id="cb14-6"><a href="-telegram-1.html#cb14-6" aria-hidden="true" tabindex="-1"></a>bot<span class="sc">$</span><span class="fu">sendMessage</span>(<span class="dv">194336771</span>, </span>
<span id="cb14-7"><a href="-telegram-1.html#cb14-7" aria-hidden="true" tabindex="-1"></a>                tg_table,</span>
<span id="cb14-8"><a href="-telegram-1.html#cb14-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;Markdown&quot;</span>)</span></code></pre></div>
<p><img src="http://img.netpeak.ua/alsey/160295200291_kiss_174kb.png" /></p>
</div>
<div id="как-добавить-в-сообщение-emoji" class="section level2" number="1.5">
<h2><span class="header-section-number">1.5</span> Как добавить в сообщение Emoji</h2>
<p>Требования к телеграм ботам могут быть разные, в том числе заказчик может попросить вас добавить в сообщения бота какие то Emoji.</p>
<p>Получить полный список доступных смайлов можно по этой <a href="https://apps.timwhitlock.info/emoji/tables/unicode">ссылке</a>.</p>
<div class="figure">
<img src="http://img.netpeak.ua/alsey/160070556432_kiss_104kb.png" alt="" />
<p class="caption">Таблица смайлов</p>
</div>
<p>Из таблицы нас интересует поле <strong>Unicode</strong>. Скопиройте код нужного вам смайла, и замените <code>U+</code> на <code>\U000</code>. Т.е. если вам необходимо отправить смайл, код котого в <a href="https://apps.timwhitlock.info/emoji/tables/unicode">таблице</a> <code>U+1F601</code>, то в коде на R вам необходимо добавить его в текст сообщения вот так - <code>\U0001F601</code>.</p>
<p>Пример:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="-telegram-1.html#cb15-1" aria-hidden="true" tabindex="-1"></a>bot<span class="sc">$</span><span class="fu">sendMessage</span>(chat_id, </span>
<span id="cb15-2"><a href="-telegram-1.html#cb15-2" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;Сообщение со смайлом \U0001F601 код которого в таблице U+1F601&#39;</span>)</span></code></pre></div>
<p>Результат:
<img src="http://img.netpeak.ua/alsey/160070602417_kiss_156kb.png" /></p>
</div>
<div id="проверка-планировщика-задач-windows-и-отправка-уведомления-о-задачах-работа-которых-была-завершена-аварийно" class="section level2" number="1.6">
<h2><span class="header-section-number">1.6</span> Проверка планировщика задач Windows, и отправка уведомления о задачах, работа которых была завершена аварийно</h2>
<p>Для работы с планировщиком заданий Windows вам необходимо установить пакет <code>taskscheduleR</code>, и для удобства работы с данными установим пакет <code>dplyr</code>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="-telegram-1.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Установка пакетов</span></span>
<span id="cb16-2"><a href="-telegram-1.html#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">&#39;taskscheduleR&#39;</span>, <span class="st">&#39;dplyr&#39;</span>))</span>
<span id="cb16-3"><a href="-telegram-1.html#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Подключение пакетов</span></span>
<span id="cb16-4"><a href="-telegram-1.html#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(taskscheduleR)</span>
<span id="cb16-5"><a href="-telegram-1.html#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<p>Далее с помощью функции <code>taskscheduler_ls()</code> мы запрашиваем информацию о задачах из нашего планировщика. С помощью функции <code>filter()</code> из пакета <code>dplyr</code> мы убираем из списка задач те, которые были успешно выполненны и имеют статус последнего результата 0, и те, которые ещё ни разу не запускались и имеют статус 267011, выключенные задачи, и задачи которые выполняются в данный момент.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="-telegram-1.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># запрашиваем список задач</span></span>
<span id="cb17-2"><a href="-telegram-1.html#cb17-2" aria-hidden="true" tabindex="-1"></a>task <span class="ot">&lt;-</span> task <span class="ot">&lt;-</span> <span class="fu">taskscheduler_ls</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="-telegram-1.html#cb17-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="sc">!</span> <span class="st">`</span><span class="at">Last Result</span><span class="st">`</span>  <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;267011&quot;</span>) <span class="sc">&amp;</span> </span>
<span id="cb17-4"><a href="-telegram-1.html#cb17-4" aria-hidden="true" tabindex="-1"></a>               <span class="st">`</span><span class="at">Scheduled Task State</span><span class="st">`</span> <span class="sc">==</span> <span class="st">&quot;Enabled&quot;</span> <span class="sc">&amp;</span> </span>
<span id="cb17-5"><a href="-telegram-1.html#cb17-5" aria-hidden="true" tabindex="-1"></a>               Status <span class="sc">!=</span> <span class="st">&quot;Running&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-6"><a href="-telegram-1.html#cb17-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(TaskName) <span class="sc">%&gt;%</span></span>
<span id="cb17-7"><a href="-telegram-1.html#cb17-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-8"><a href="-telegram-1.html#cb17-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">unlist</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-9"><a href="-telegram-1.html#cb17-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste0</span>(., <span class="at">collapse =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<p>В объекте <code>task</code> у нас теперь список задач, работа которых завершилась ошибкой, этот список нам надо отправить в Telegram.</p>
<p>Если рассмотреть каждую команду подробнее, то:</p>
<ul>
<li><code>filter()</code> - фильтрует список задач, по описанным выше условиям</li>
<li><code>select()</code> - оставляет в таблице только одно поле с названием задач</li>
<li><code>unique()</code> - убирает дубли названий</li>
<li><code>unlist()</code> - переводит выбранный столбец таблицы в вектор</li>
<li><code>paste0()</code> - соединяет названия задач в одну строку, и ставит в качестве разделителя знак перевода строки, т.е. <code>\n</code>.</li>
</ul>
<p>Всё что нам остаётся - отправить этот результат в телеграм.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="-telegram-1.html#cb18-1" aria-hidden="true" tabindex="-1"></a>bot<span class="sc">$</span><span class="fu">sendMessage</span>(chat_id,</span>
<span id="cb18-2"><a href="-telegram-1.html#cb18-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">text =</span> task,</span>
<span id="cb18-3"><a href="-telegram-1.html#cb18-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">parse_mode =</span> <span class="st">&quot;Markdown&quot;</span></span>
<span id="cb18-4"><a href="-telegram-1.html#cb18-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Итак, на данный момент код бота выглядит вот так:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="-telegram-1.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Подключение пакета</span></span>
<span id="cb19-2"><a href="-telegram-1.html#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(telegram.bot)</span>
<span id="cb19-3"><a href="-telegram-1.html#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(taskscheduleR)</span>
<span id="cb19-4"><a href="-telegram-1.html#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb19-5"><a href="-telegram-1.html#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="-telegram-1.html#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># инициализируем бота</span></span>
<span id="cb19-7"><a href="-telegram-1.html#cb19-7" aria-hidden="true" tabindex="-1"></a>bot <span class="ot">&lt;-</span> <span class="fu">Bot</span>(<span class="at">token =</span> <span class="st">&quot;123456789:abcdefghijklmnopqrstuvwxyz&quot;</span>)</span>
<span id="cb19-8"><a href="-telegram-1.html#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="-telegram-1.html#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co"># идентификатор чата</span></span>
<span id="cb19-10"><a href="-telegram-1.html#cb19-10" aria-hidden="true" tabindex="-1"></a>chat_id <span class="ot">&lt;-</span> <span class="dv">123456789</span></span>
<span id="cb19-11"><a href="-telegram-1.html#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="-telegram-1.html#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co"># запрашиваем список задач</span></span>
<span id="cb19-13"><a href="-telegram-1.html#cb19-13" aria-hidden="true" tabindex="-1"></a>task <span class="ot">&lt;-</span> <span class="fu">taskscheduler_ls</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-14"><a href="-telegram-1.html#cb19-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="sc">!</span> <span class="st">`</span><span class="at">Last Result</span><span class="st">`</span>  <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;267011&quot;</span>)  <span class="sc">&amp;</span></span>
<span id="cb19-15"><a href="-telegram-1.html#cb19-15" aria-hidden="true" tabindex="-1"></a>               <span class="st">`</span><span class="at">Scheduled Task State</span><span class="st">`</span> <span class="sc">==</span> <span class="st">&quot;Enabled&quot;</span> <span class="sc">&amp;</span> </span>
<span id="cb19-16"><a href="-telegram-1.html#cb19-16" aria-hidden="true" tabindex="-1"></a>               Status <span class="sc">!=</span> <span class="st">&quot;Running&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-17"><a href="-telegram-1.html#cb19-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(TaskName) <span class="sc">%&gt;%</span></span>
<span id="cb19-18"><a href="-telegram-1.html#cb19-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-19"><a href="-telegram-1.html#cb19-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">unlist</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-20"><a href="-telegram-1.html#cb19-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste0</span>(., <span class="at">collapse =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb19-21"><a href="-telegram-1.html#cb19-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-22"><a href="-telegram-1.html#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="co"># если есть проблемные задачи отправляем сообщение</span></span>
<span id="cb19-23"><a href="-telegram-1.html#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> ( task <span class="sc">!=</span> <span class="st">&quot;&quot;</span> ) {</span>
<span id="cb19-24"><a href="-telegram-1.html#cb19-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-25"><a href="-telegram-1.html#cb19-25" aria-hidden="true" tabindex="-1"></a>  bot<span class="sc">$</span><span class="fu">sendMessage</span>(chat_id,</span>
<span id="cb19-26"><a href="-telegram-1.html#cb19-26" aria-hidden="true" tabindex="-1"></a>                  <span class="at">text =</span> task,</span>
<span id="cb19-27"><a href="-telegram-1.html#cb19-27" aria-hidden="true" tabindex="-1"></a>                  <span class="at">parse_mode =</span> <span class="st">&quot;Markdown&quot;</span></span>
<span id="cb19-28"><a href="-telegram-1.html#cb19-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-29"><a href="-telegram-1.html#cb19-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-30"><a href="-telegram-1.html#cb19-30" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><em>При использовании приведённого выше примера подставьте в код токен вашего бота и ваш идентификатор чата.</em></p>
<p>Вы можете добавлять условия фильтрации задач, например проверяя только те задачи, которые были созданны вами, исключая системные.</p>
<p>Так же вы можете вынести различные настройки в отдельный файл конфигурации, и хранить в нём id чата и токен. Читать конфиг можно например с помощью пакета <code>configr</code>.</p>
<pre><code>[telegram_bot]
;настройки телеграм бота и чата, в который будут приходить уведомления
chat_id=12345678
bot_token=123456789:abcdefghijklmnopqrstuvwxyz&quot;</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="-telegram-1.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(configr)</span>
<span id="cb21-2"><a href="-telegram-1.html#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="-telegram-1.html#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># чтение конфина</span></span>
<span id="cb21-4"><a href="-telegram-1.html#cb21-4" aria-hidden="true" tabindex="-1"></a>config <span class="ot">&lt;-</span> <span class="fu">read.config</span>(<span class="st">&#39;C:/путь_к_конфигу/config.cfg&#39;</span>, <span class="at">rcmd.parse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-5"><a href="-telegram-1.html#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="-telegram-1.html#cb21-6" aria-hidden="true" tabindex="-1"></a>bot_token <span class="ot">&lt;-</span> config<span class="sc">$</span>telegram_bot<span class="sc">$</span>bot_token</span>
<span id="cb21-7"><a href="-telegram-1.html#cb21-7" aria-hidden="true" tabindex="-1"></a>chat_id     <span class="ot">&lt;-</span> config<span class="sc">$</span>telegram_bot<span class="sc">$</span>chat_id</span></code></pre></div>
</div>
<div id="настраиваем-расписание-запуска-проверки-задач" class="section level2" number="1.7">
<h2><span class="header-section-number">1.7</span> Настраиваем расписание запуска проверки задач</h2>
<p>Наиболее подробно процесс настройки запуска скриптов по расписанию описан в этой <a href="https://netpeak.net/ru/blog/kak-nastroit-zapusk-r-skripta-po-raspisaniyu/">статье</a> . Тут я лишь опишу шаги, которые для этого необходимо выполнить. Если какой-то из шагов вам не понятен, то обратитесь к статье на которую я указал ссылку.</p>
<p>Предположим, что мы сохранили код нашего бота в файл <code>check_bot.R</code>. Для того, что бы запланировать регулярный запуск этого файла выполните следующие шаги:</p>
<ol style="list-style-type: decimal">
<li>Пропишите в системную переменную Path путь к папке в которой установлен R, в Windows путь будет примерно таким: <code>C:\Program Files\R\R-4.0.2\bin</code>.</li>
<li>Создайте исполняемый bat файл, в котором будет всего одна строка <code>R CMD BATCH C:\rscripts\check_bot\check_bot.R</code>. Замените <code>C:\rscripts\check_bot\check_bot.R</code> на полный путь к вашему R файлу.</li>
<li>Далее настройте с помощью планировщика задач Windows расписание запуска, например на каждые пол часа.</li>
</ol>
</div>
<div id="заключение" class="section level2" number="1.8">
<h2><span class="header-section-number">1.8</span> Заключение</h2>
<p>В этой главе мы разобрались с тем, как создать бота, и отправлять с его помощью различные уведомления в telegram.</p>
<p>Я описал задачу контроля планировщика заданий Windows, но вы можете использовать материал этой главы для отправки любых уведомлений, от прогноза погоды до котировок акций на фондовой бирже, т.к. R позволяет вам подключиться к огромному количеству источников данных.</p>
<p>В следующей главе мы с вами разберёмся с тем, как добавить боту команды и фильтры сообщений, для того, что он мог не только отправлять уведомления, но и выполнять более сложные действия.</p>
</div>
<div id="тесты-и-задания" class="section level2" number="1.9">
<h2><span class="header-section-number">1.9</span> Тесты и задания</h2>
<div id="тесты" class="section level3" number="1.9.1">
<h3><span class="header-section-number">1.9.1</span> Тесты</h3>
<p>Для закрепления материла рекомендую вам пройти тест доступный по <a href="https://onlinetestpad.com/t/build-tg-bot-in-r-1">ссылке</a>.</p>
</div>
<div id="задания" class="section level3" number="1.9.2">
<h3><span class="header-section-number">1.9.2</span> Задания</h3>
<ol style="list-style-type: decimal">
<li>Создайте с помощью <a href="http://t.me/BotFather">BotFather</a> бота.</li>
<li>Перейдите к диалогу с ботом, и узнайте идентификатор вашего с ботом чата.</li>
<li>Отправьте с помощью созданного бота в telegram первые 20 строк из встроенного в R набора данных <code>ToothGrowth</code>.</li>
</ol>
<p>Если вы всё сделали правильно то результат будет следующим:
<img src="http://img.netpeak.ua/alsey/160390694961_kiss_150kb.png" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="-updater-2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/01-send_message_to_telegram.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
